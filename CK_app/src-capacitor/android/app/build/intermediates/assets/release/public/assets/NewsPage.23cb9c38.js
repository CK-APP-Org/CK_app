import{Q as U,b as E,a as x}from"./QTable.fea4acab.js";import{k as R,c as P,h as y,Y as W,g as Y,_ as Z,r as q,o as $,I as c,N as f,K as o,a1 as _,f as i,J as d,O as Q,M as T,a0 as g,F as v,P as K,L as m,a2 as G,a3 as X}from"./index.3a795f78.js";import{h as ee,k as te,d as b}from"./QBtn.31503470.js";import{u as ae,a as re,Q as ne,b as oe}from"./QCard.ae813421.js";import{b as se,d as le,Q as ie}from"./QDialog.87a95078.js";import{Q as ce}from"./QCardActions.4cdd3666.js";import{Q as ue}from"./QPage.77fe52b4.js";import{a as de}from"./axios.bf56c3c5.js";import"./QSeparator.16f36955.js";import"./QList.b9c37d33.js";import"./QSelect.faff267b.js";import"./rtl.eb0210c3.js";import"./QItem.8449fe23.js";import"./selection.35dcb10c.js";import"./scroll.8cbac293.js";import"./QCheckbox.4ef32505.js";import"./use-fullscreen.4ebdb7a0.js";var I=R({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:t}){const r=P(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>y("tr",{class:r.value},ee(t.default))}}),me=R({name:"QInnerLoading",props:{...ae,...se,showing:Boolean,color:String,size:{type:[String,Number],default:"42px"},label:String,labelClass:String,labelStyle:[String,Array,Object]},setup(e,{slots:t}){const r=Y(),n=re(e,r.proxy.$q),{transitionProps:u,transitionStyle:D}=le(e),a=P(()=>"q-inner-loading q--avoid-card-border absolute-full column flex-center"+(n.value===!0?" q-inner-loading--dark":"")),s=P(()=>"q-inner-loading__label"+(e.labelClass!==void 0?` ${e.labelClass}`:""));function z(){const S=[y(te,{size:e.size,color:e.color})];return e.label!==void 0&&S.push(y("div",{class:s.value,style:e.labelStyle},[e.label])),S}function C(){return e.showing===!0?y("div",{class:a.value,style:D.value},t.default!==void 0?t.default():z()):null}return()=>y(W,u.value,C)}}),pe=["second","minute","hour","day","week","month","year"];function fe(e,t){if(t===0)return["just now","right now"];var r=pe[Math.floor(t/2)];return e>1&&(r+="s"),[e+" "+r+" ago","in "+e+" "+r]}var ge=["\u79D2","\u5206\u949F","\u5C0F\u65F6","\u5929","\u5468","\u4E2A\u6708","\u5E74"];function ve(e,t){if(t===0)return["\u521A\u521A","\u7247\u523B\u540E"];var r=ge[~~(t/2)];return[e+" "+r+"\u524D",e+" "+r+"\u540E"]}var B={},V=function(e,t){B[e]=t},we=function(e){return B[e]||B.en_US},A=[60,60,24,7,365/7/12,12];function O(e){return e instanceof Date?e:!isNaN(e)||/^\d+$/.test(e)?new Date(parseInt(e)):(e=(e||"").trim().replace(/\.\d+/,"").replace(/-/,"/").replace(/-/,"/").replace(/(\d)T(\d)/,"$1 $2").replace(/Z/," UTC").replace(/([+-]\d\d):?(\d\d)/," $1$2"),new Date(e))}function he(e,t){var r=e<0?1:0;e=Math.abs(e);for(var n=e,u=0;e>=A[u]&&u<A.length;u++)e/=A[u];return e=Math.floor(e),u*=2,e>(u===0?9:1)&&(u+=1),t(e,u,n)[r].replace("%s",e.toString())}function _e(e,t){var r=t?O(t):new Date;return(+r-+O(e))/1e3}var be=function(e,t,r){var n=_e(e,r&&r.relativeDate);return he(n,we(t))};V("en_US",fe);V("zh_CN",ve);var j={};Object.defineProperty(j,"__esModule",{value:!0});function ye(e,t){return[["\u525B\u525B","\u7247\u523B\u5F8C"],["%s \u79D2\u524D","%s \u79D2\u5F8C"],["1 \u5206\u9418\u524D","1 \u5206\u9418\u5F8C"],["%s \u5206\u9418\u524D","%s \u5206\u9418\u5F8C"],["1 \u5C0F\u6642\u524D","1 \u5C0F\u6642\u5F8C"],["%s \u5C0F\u6642\u524D","%s \u5C0F\u6642\u5F8C"],["1 \u5929\u524D","1 \u5929\u5F8C"],["%s \u5929\u524D","%s \u5929\u5F8C"],["1 \u9031\u524D","1 \u9031\u5F8C"],["%s \u9031\u524D","%s \u9031\u5F8C"],["1 \u500B\u6708\u524D","1 \u500B\u6708\u5F8C"],["%s \u500B\u6708\u524D","%s \u500B\u6708\u5F8C"],["1 \u5E74\u524D","1 \u5E74\u5F8C"],["%s \u5E74\u524D","%s \u5E74\u5F8C"]][t]}var ke=j.default=ye;const De={name:"NewsPage",setup(){const e=P(()=>_.getters.getPinnedNews),t=q(!0),r=q([]),n=q(!1),u=[{name:"pin",required:!0,label:"",align:"left",field:()=>null},{name:"title",required:!0,label:"\u516C\u544A\u6A19\u984C",align:"left",field:l=>l.title,format:l=>`${l}`,sortable:!0,classes:"title-cell"},{name:"pubDate",required:!0,label:"\u6642\u9593",align:"right",field:l=>l.pubDate,format:l=>C(l),sortable:!0}],D=l=>{const p=r.value.findIndex(L=>L.title===l.title);p!==-1&&_.dispatch("pinNews",r.value.splice(p,1)[0])},a=l=>{_.dispatch("unpinNews",l.title),r.value.push(l)},s=q({sortBy:"pubDate",descending:!0,page:1,rowsPerPage:20}),z=async()=>{t.value=!0;const l=["https://www.ck.tp.edu.tw/nss/main/feeder/5abf2d62aa93092cee58ceb4/KG5mY0d9355?f=normal&%240=hhyrNQJ0110&vector=private&static=false","https://www.ck.tp.edu.tw/nss/main/feeder/5abf2d62aa93092cee58ceb4/IXZld9j7619?f=normal&%240=kpenVCJ9015&vector=private&static=false"];try{const p=_.getters.getLastClearedTime,L=l.map(w=>de.get("https://ck-web-news-9f40e6bce7de.herokuapp.com/proxy",{params:{url:w}})),J=await Promise.all(L);let N=[];J.forEach(w=>{const F=new DOMParser().parseFromString(w.data,"text/xml"),H=Array.from(F.querySelectorAll("item")).map(h=>({title:h.querySelector("title").textContent,pubDate:new Date(h.querySelector("pubDate").textContent),link:h.querySelector("link").textContent})).filter(h=>!p||h.pubDate>new Date(p));N=N.concat(H)}),N.sort((w,M)=>M.pubDate-w.pubDate),r.value=N}catch(p){console.error("Error fetching news:",p)}finally{t.value=!1}},C=l=>be(l,"zh_TW"),S=()=>{r.value=[];const l=new Date;_.dispatch("setLastClearedTime",l),n.value=!1};return $(()=>{console.log(JSON.parse(localStorage.getItem("store"))),V("zh_TW",ke),z()}),{news:r,columns:u,formatTimeAgo:C,pagination:s,isLoading:t,pinnedNews:e,pinRow:D,unpinRow:a,showDeleteDialog:n,deleteAllNews:S}}},k=e=>(G("data-v-1e817803"),e=e(),X(),e),Ce=k(()=>m("div",{class:"text-h6 div-header"},"\u5DF2\u91D8\u9078",-1)),Se=["href"],Ne={class:"row items-center full-width q-px-sm"},xe=k(()=>m("div",{class:"col-2"},null,-1)),qe=k(()=>m("div",{class:"col-8 text-center"},[m("div",{class:"text-h6"},"\u672A\u8B80\u8A0A\u606F")],-1)),Qe={class:"col-2 text-right"},Te=["href"],Ie=k(()=>m("div",{class:"full-width row flex-center q-gutter-sm text-body1"}," \u6C92\u6709\u66F4\u65B0\u7684\u516C\u544A ",-1)),Pe=k(()=>m("div",{class:"text-h6"},"\u78BA\u8A8D\u5DF2\u8B80\u6240\u6709\u8A0A\u606F?",-1));function ze(e,t,r,n,u,D){return c(),f(ue,{class:"q-pa-md"},{default:o(()=>[n.pinnedNews.length>0?(c(),f(U,{key:0,rows:n.pinnedNews,columns:n.columns,"row-key":"title",class:"my-custom-table-2 q-mb-md","wrap-cells":!0,dense:e.$q.screen.lt.md,"rows-per-page-options":[0],"hide-pagination":""},{top:o(()=>[Ce]),header:o(a=>[i(I,{props:a},{default:o(()=>[(c(!0),d(v,null,Q(a.cols,s=>(c(),f(E,{key:s.name,props:a,class:"custom-header"},{default:o(()=>[T(g(s.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:o(a=>[i(I,{props:a},{default:o(()=>[i(x,{"auto-width":""},{default:o(()=>[i(b,{size:"sm",color:"negative",round:"",dense:"",icon:"push_pin",onClick:s=>n.unpinRow(a.row)},null,8,["onClick"])]),_:2},1024),(c(!0),d(v,null,Q(a.cols.slice(1),s=>(c(),f(x,{key:s.name,props:a},{default:o(()=>[s.name==="title"?(c(),d("a",{key:0,href:a.row.link,target:"_blank",rel:"noopener noreferrer"},g(s.value),9,Se)):(c(),d(v,{key:1},[T(g(s.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),_:1},8,["rows","columns","dense"])):K("",!0),i(U,{rows:n.news,columns:n.columns,"row-key":"title",class:"my-custom-table-2","wrap-cells":!0,dense:e.$q.screen.lt.md,"rows-per-page-options":[20,50,100,0],"rows-per-page-label":"\u6BCF\u9801\u6700\u5927\u986F\u793A\u6578\u91CF:",pagination:n.pagination,"onUpdate:pagination":t[1]||(t[1]=a=>n.pagination=a),loading:n.isLoading},{top:o(()=>[m("div",Ne,[xe,qe,m("div",Qe,[i(b,{color:"negative",icon:"delete",onClick:t[0]||(t[0]=a=>n.showDeleteDialog=!0),dense:""})])])]),header:o(a=>[i(I,{props:a},{default:o(()=>[(c(!0),d(v,null,Q(a.cols,s=>(c(),f(E,{key:s.name,props:a,class:"custom-header"},{default:o(()=>[T(g(s.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:o(a=>[i(I,{props:a},{default:o(()=>[i(x,{"auto-width":""},{default:o(()=>[i(b,{size:"sm",color:"primary",round:"",dense:"",icon:"push_pin",onClick:s=>n.pinRow(a.row)},null,8,["onClick"])]),_:2},1024),(c(!0),d(v,null,Q(a.cols.slice(1),s=>(c(),f(x,{key:s.name,props:a},{default:o(()=>[s.name==="title"?(c(),d("a",{key:0,href:a.row.link,target:"_blank",rel:"noopener noreferrer"},g(s.value),9,Te)):(c(),d(v,{key:1},[T(g(s.value),1)],64))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),loading:o(()=>[i(me,{showing:"",color:"primary"})]),"no-data":o(()=>[Ie]),_:1},8,["rows","columns","dense","pagination","loading"]),i(ie,{modelValue:n.showDeleteDialog,"onUpdate:modelValue":t[3]||(t[3]=a=>n.showDeleteDialog=a)},{default:o(()=>[i(ne,null,{default:o(()=>[i(oe,null,{default:o(()=>[Pe]),_:1}),i(ce,{align:"right"},{default:o(()=>[i(b,{flat:"",label:"\u53D6\u6D88",onClick:t[2]||(t[2]=a=>n.showDeleteDialog=!1)}),i(b,{flat:"",label:"\u78BA\u8A8D",onClick:n.deleteAllNews},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ge=Z(De,[["render",ze],["__scopeId","data-v-1e817803"]]);export{Ge as default};
